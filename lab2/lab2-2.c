#include <stdlib.h> 
#include <stdio.h>
#include <string.h>
#include <sys/types.h>
#include <sys/shm.h>
#include <sys/wait.h>
#define KEY 4567
#define PERMS 0660

int main(int argc, char const *argv[])
{
	//variables for calcul
	int a,b,c,d,e,f;
	a = 10;
	b = -2; //8
	c = -5; // 2
	d = 7;
	e = 12; //13
	f = 1;

	int tmp = 0;

	//Variables for sharedMemory
	int id; 
	int *ptr;
	id = shmget(KEY, sizeof(int), IPC_CREAT | PERMS);
	ptr = (int *) shmat(id, NULL, 0);
	
	//process 1
	if(fork()==0){
		*ptr = a + b; 
		printf("I'm the process P1 (PID : %d), and my calcul is : %d + %d = %d\n", getpid(), a, b, *ptr);

	}else{
		wait(NULL);
		//Process P2
		if(fork()==0){
			tmp = *ptr * (c + d);
			printf("I'm the process P2 (PID : %d), and my calcul is : %d * (%d + %d) = %d\n", getpid(),*ptr, c, d, tmp); 
			*ptr = tmp;
			exit(0);
		}else{
			wait(NULL);
			//Process P3
			if(fork()==0){
				tmp = *ptr * (e + f);
				printf("I'm the process P3 (PID : %d), and my calcul is : %d * (%d + %d) = %d\n", getpid(),*ptr, e, f, tmp); 
				*ptr = tmp;
				exit(0);
			}	
		}
	}
	wait(NULL);
	return 0;
}

