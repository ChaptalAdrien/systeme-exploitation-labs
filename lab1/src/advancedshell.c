#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <string.h>



//Functions

//Get input from user 
char* getUserPrompt(char* input){
    if(fgets(input,sizeof(input),stdin) == NULL){
        printf("*** ERROR: read prompt failed\n");
        perror("fgets");
        exit(1);
    }else{
        //Exit the shell if user prompt exit
        if(strcmp(input,"exit\n")==0){
            exit(1);
        }else{
            //Removing \n at the end of input
            for(int i=(sizeof(input) -1); i!=-1; i--){
                if(input[i]=='\n'){
                    input[i] = '\0';    
                }
            }
            return input;
        }
    }
}

//execute commande in child process
int executeInput(){
    pid = fork();
        if(pid == 0){
            //execute command
            char *args[]={input,NULL};
            if (execvp(args[0],args) < 0) {     
                printf("*** ERROR: exec failed\n");
                perror("execvp");
                return 1;
            }
        }else if(pid == -1){
            printf("*** ERROR: fork() failed\n");
            perror("fork");
            return 1;        
        }else{
            return 0;
        }
}

int main(){

    pid_t pid;
    char input[100];

    //Infinite loop to keep the shell running
    while(1==1){
        
        //Wait for child to finish
        int returnStatus;
        waitpid(pid, &returnStatus, 0);

        //read user prompt
        printf("SimpleShell>");
        input = getUserPrompt(input);
        //execute commande in child process
        if(executeInput(input)==1){
            exit(1); 
        }
    }
}
